#!/usr/bin/env node

/**
 * Data Sync Script
 * Syncs JSON files to game-data.js for static deployment
 */

const fs = require('fs');
const path = require('path');

console.log('ğŸ”„ åŒæ­¥æ•¸æ“šæ–‡ä»¶...\n');

try {
    // Read JSON files
    console.log('ğŸ“– è®€å– JSON æ–‡ä»¶...');
    const config = JSON.parse(fs.readFileSync('data/config.json', 'utf8'));
    const items = JSON.parse(fs.readFileSync('data/items.json', 'utf8'));
    const itemEvents = JSON.parse(fs.readFileSync('data/item-events.json', 'utf8'));
    const baseScenes = JSON.parse(fs.readFileSync('data/base-scenes.json', 'utf8'));
    const disasters = JSON.parse(fs.readFileSync('data/disasters.json', 'utf8'));
    
    console.log('âœ… Config:', Object.keys(config).length, 'å€‹é…ç½®');
    console.log('âœ… Items:', items.items.length, 'å€‹ç‰©å“');
    console.log('âœ… Events:', Object.keys(itemEvents.events).length, 'å€‹äº‹ä»¶');
    console.log('âœ… Base Scenes:', Object.keys(baseScenes.scenes).length, 'å€‹å ´æ™¯');
    console.log('âœ… Disasters:', Object.keys(disasters.disasters).length, 'ç¨®ç½é›£');
    
    // Generate JavaScript file
    console.log('\nğŸ“ ç”Ÿæˆ game-data.js...');
    
    const output = `// Game Data - All JSON data embedded as JavaScript
// This allows the game to run without a server
// Auto-generated by sync-data.js - DO NOT EDIT MANUALLY

window.GAME_DATA = ${JSON.stringify({
        config: config,
        items: items.items,
        itemEvents: itemEvents.events,
        baseScenes: baseScenes.scenes,
        disasters: disasters.disasters
    }, null, 4)};
`;

    fs.writeFileSync('data/game-data.js', output, 'utf8');
    
    console.log('âœ… å·²ç”Ÿæˆ data/game-data.js');
    
    // Calculate file sizes
    const jsonSize = ['config.json', 'items.json', 'item-events.json', 'base-scenes.json', 'disasters.json']
        .reduce((sum, file) => sum + fs.statSync(`data/${file}`).size, 0);
    const jsSize = fs.statSync('data/game-data.js').size;
    
    console.log('\nğŸ“Š æ–‡ä»¶å¤§å°ï¼š');
    console.log(`   JSON æ–‡ä»¶ç¸½è¨ˆ: ${(jsonSize / 1024).toFixed(2)} KB`);
    console.log(`   game-data.js: ${(jsSize / 1024).toFixed(2)} KB`);
    console.log(`   å·®ç•°: ${((jsSize - jsonSize) / 1024).toFixed(2)} KB (${((jsSize / jsonSize - 1) * 100).toFixed(1)}%)`);
    
    console.log('\nâœ¨ åŒæ­¥å®Œæˆï¼');
    console.log('ğŸ’¡ ç¾åœ¨å¯ä»¥ç›´æ¥æ‰“é–‹ index-new.html ä½¿ç”¨éŠæˆ²');
    
} catch (error) {
    console.error('\nâŒ åŒæ­¥å¤±æ•—:', error.message);
    process.exit(1);
}
